<template name="contactables">
    <div id="content" class="network-content nicer-filters">
        <div class="row">
            <div class="col-md-3 col-lg-3" id="column-filters">
                {{> contactablesFilters }}
            </div>
            <div class="col-md-9" id="column-list">
                <div class="list-container">
                    <div class="list-holder">

                        <div class="list-actions">
                            {{>contactablesListSearch}}
                        </div>

                        {{>contactablesListHeader}}

                        {{#if isSearching}}
                            searching
                        {{else}}
                            {{> contactablesList }}
                        {{/if}}

                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<template name="contactablesFilters">
    {{#with information}}
        <div class="page-title">
            <h1><span>{{contactablesCount.value}}</span> network records</h1>
        </div>
    {{/with}}

    <div class="filter">
        <a class="filter-toggle" data-toggle="collapse" href="#filter-body"><i class="fa fa-filter"></i> Filters</a>

        <div class="filter-list" id="filter-body">
            {{> filter_entityType types=contactableTypes selected=query.objType}}

            {{#if isSelectedType 'Employee'}}
                {{> filter_lookUp title="Process status" code=7 lookUpValue=query.employeeProcessStatus multi=true}}
            {{/if}}
            {{#if isSelectedType 'Contact'}}
                {{> filter_lookUp title="Process status" code=12 lookUpValue=query.contactProcessStatus multi=true}}
            {{/if}}
            {{#if isSelectedType 'Customer'}}
                {{> filter_lookUp title="Process status" code=14 lookUpValue=query.customerProcessStatus multi=true}}
            {{/if}}
            {{> filter_lookUp title="Active status" code=13 lookUpValue=query.activeStatus multi=true}}


            {{> filter_createdDate selectedLimit=query.selectedLimit}}

            {{> filter_createdBy showMineOnly=query.mineOnly}}

            {{> filter_tags tags=query.tags}}

            {{> filter_location location=query.location}}
            {{> filter_taxId taxId=query.taxId}}
        </div>
    </div>
</template>

<template name="contactablesList">
    {{#if isLoading}}
        <div style="height: 505px;"></div>
    {{else}}
        {{#each contactables}}
            <div class="list-item-section">
                {{> contactablesListItem }}
            </div>
        {{else}}
            {{#if info.isFiltering.value }}
                <div class="v-wrapper">
                    <div class="v-wrapper-cell text-center text-muted" style="height: 678px;">
                        <i class="icon-connection-1 text-large"></i>

                        <h1>
                            No records Found
                        </h1>
                    </div>
                </div>
            {{else}}
                <div class="v-wrapper">
                    <div class="v-wrapper-cell text-center text-muted" style="height: 678px;">
                        <i class="icon-connection-1 text-large"></i>

                        <a href="#"
                           data-bind="attr: { href: '/contactableAdd/'+name() }, text: 'New ' + name()"></a>
                        <span class="bullet-spacer"
                              data-bind="visible: $index()< $parent.contactableTypes().length-1">Â·</span>
                    </div>
                </div>
            {{/if}}
        {{/each}}

        <div class="list-actions last">
            {{#if listIsLoading}}
                loading
            {{else}}
                {{#unless isESSearch}}
                    {{>fastPagination name="auxContactables" useKeys='true'}}
                {{/unless}}
            {{/if}}
        </div>
    {{/if}}
</template>

<template name="contactablesListItem">
    <div class="list-item network-list-item {{#if isSelected}} selected {{/if}}">
        {{#if listViewMode}}
            <div class="table-item-cell">
                <div class="table-item-cell-container">
                    <div class="table-item-title">
                        <a href="/contactable/{{_id}}">
                            {{displayName}} {{getDepartment}}
                        </a>
                        <span class="pull-right">
                            <span class="task-author">
                                {{displayUserName userId}}
                            </span>
                              <span class="task-author">
                                  {{_id}}
                              </span>
                              <span class="task-author">
                                  {{#formattedDate value=dateCreated format='fromNow'}}
                                      {{date}}
                                  {{/formattedDate}}
                              </span>
                        </span>
                    </div>
                </div>
            </div>
        {{else}}
            <div class="list-item-cell network-list-item-checkbox">
                <input type="checkbox" class="select" checked="{{isSelected}}">
            </div>
            <div class="list-item-cell list-item-icon">
                <a class="item-icon item-icon-network" href="/contactable/{{_id}}">
                    {{#if pictureFileId }}
                        {{#with pictureUrl pictureFileId}}
                            <a href="#">
                                <img src="{{.}}">
                            </a>
                        {{/with}}
                    {{else}}
                        {{#if organization }}<i class="icon-buildings-1"></i>{{/if}}
                        {{#if person }}<i class="icon-profile-business-man"></i>{{/if}}
                    {{/if}}
                </a>
            </div>

            <div class="list-item-cell network-list-item-title">
                <div class="item-title {{#if Customer}}single{{/if}}{{#if getDepartment}}single{{/if}}"><a href="#">{{displayName}}</a></div>
                <div class="item-subtitle">
                    {{#if Customer}}
                        {{> customerInformation }}
                    {{/if}}
                    {{#if Employee}}
                        {{> employeeInformation }}
                    {{/if}}
                    {{#if Contact}}
                        {{> contactInformation }}
                    {{/if}}
                    {{#if getDepartment}}
                        <a href="#"><em>{{getDepartment}}</em></a>
                    {{/if}}
                </div>
            </div>
            <div class="list-item-details network-list-item-details">
                <div class="list-item-cell network-list-item-contact">
                    {{#each contactMethods}}
                        <button class="btn-round" type="button"
                                data-container="body" data-toggle="popover" data-placement="top" data-html="true"
                                data-content='<a href="{{contactMethodTypePrefix type}}{{value}}">{{value}}</a>' data-init="off">
                            <i class="{{contactMethodTypeIcon type}}"></i>
                        </button>
                    {{/each}}
                    {{#if location.displayName}}
                        <button class="btn-round" type="button"
                                data-container="body" data-toggle="popover" data-placement="top" data-html="true"
                                data-content='{{location.displayName}}' data-init="off">
                            <i class="fa fa-map-marker"></i>
                        </button>
                    {{/if}}
                </div>
                <div class="list-item-cell network-list-item-type">{{displayObjType}}</div>
                <div class="list-item-cell network-list-item-status">
                    <span class="item-label">{{lookUpName getProcessStatus}}</span>
                    <span class="item-label" data-status="{{lookUpName activeStatus}}">{{lookUpName activeStatus}}</span>
                </div>
                <div class="list-item-cell network-list-item-code">{{displaySearchKey _id}}</div>
                <div class="list-item-cell network-list-item-owner">{{displayUserName userId}}</div>
                <div class="list-item-cell network-list-item-time">
                    {{#formattedDate value=dateCreated format='fromNow'}}
                        <span>{{date}}</span>
                    {{/formattedDate}}
                </div>
                <div class="list-item-cell item-overflow network-item-overflow">
                    <a href="#">
                        <span class="ico-more">
                          <span class="dot-1"></span>
                          <span class="dot-2"></span>
                          <span class="dot-3"></span>
                        </span>
                    </a>
                </div>
            </div><!-- /.list-item-cell -->
            {{#with getLastNote}}
                <div class="list-item-more network-list-item-more">
                    <div class="list-item-more-entry">
                        <div class="list-item-more-entry-icon"></div>
                        <div class="list-item-more-entry-content">
                            <div class="list-item-more-ico item-icon-notes"><i class="icon icon-pencil-3"></i></div>
                            <div class="time">
                                {{#formattedDate value=dateCreated format='fromNow'}}
                                    {{date}}
                                {{/formattedDate}}
                            </div>
                            <a href="#">{{displayUserName userId}}</a> - {{msg}}
                        </div>
                    </div><!-- /.list-item-more-entry -->
                </div><!-- /.list-item-more -->
            {{/with}}
        {{/if}}
    </div>
</template>

<template name="esContextMatch">
    <span class="text-muted separatedLinks contextText"></span>
</template>

<template name="customerInformation">
</template>

<template name="employeeInformation">
    {{#if placementInfo}}
        {{#with placementInfo}}
            <a href="/job/{{job}}"><span class="info">{{jobTitle}}</span></a> {{#if customerName}} &#x2219; <a
                href="/contactable/{{customer}}"> {{customerName}} </a> {{/if}}
        {{/with}}
    {{else}}
        {{#if person}}
            {{#if person.jobTitle}}
                {{person.jobTitle}}
            {{/if}}
        {{/if}}
    {{/if}}
    <br/>
</template>

<template name="contactInformation">
    {{#if Contact.customer}}
        <a href="/contactable/{{Contact.customer}}">
            {{Contact.customerName}}
        </a>
    {{/if}}
    <br/>
</template>

<template name="contactablesListSearch">
        <div class="list-actions-cell btn-add-to-list">
            <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown"
                    title="Add">
                <span class="fa fa-plus"></span> Add
            </button>
            <ul class="dropdown-menu" role="menu" data-bind="foreach: contactableTypes">
                {{#each contactableTypes}}
                    <li><a href="/contactableAdd/{{name}}">Add {{name}}</a></li>
                {{/each}}
                <li>
                    <a type="button" title="Create employee from resume/CV"
                       href="/resumeparser">Create employee from resume/CV file</a>
                </li>
                <li>
                    <a class="parseText"
                       title="Create employee from plain text">Create employee from resume/CV text</a>
                </li>
            </ul>
        </div><!-- /.btn-add-to-list -->

        <div class="list-actions-cell search-list">
            <div class="input-group">
                <span class="prop-input">
                    {{#objectProperty property=searchString}}
                        <input type="text" class="form-control" placeholder="Search network" value="{{value}}">
                    {{/objectProperty}}
                <span class="text text-danger"></span>
                </span>
                <span class="input-group-btn">
                    <button class="btn btn-search" type="button">
                        <i class="fa fa-search"></i>
                    </button>
                </span>
            </div>
        </div><!-- /.search-list -->

        <div class="list-actions-cell view-mode-list">
            {{#if listViewMode}}
                <a href="#"><i id="detail-view" class="fa fa-th-list"></i></a>
                <a class="active" href="#"><i class="fa fa-bars"></i></a>
            {{else}}
                <a class="active" href="#"><i class="fa fa-th-list"></i></a>
                <a href="#"><i id="list-view" class="fa fa-bars"></i></a>
            {{/if}}
            <a id="toggle-filters" href="#"><i class="fa fa-desktop"></i></a>
        </div><!-- /.view-mode-list -->

        <div class="list-actions-cell order-list">
            {{> contactableListSort}}
        </div><!-- ./order-list -->

        {{#if listIsLoading}}
            loading
        {{else}}
            {{#unless isESSearch}}
                {{>fastPagination name="auxContactables" useKeys='true'}}
            {{/unless}}
        {{/if}}
</template>

<template name="contactablesListHeader">
    <div class="list-header network-list-header">
        <div class="list-header-cell network-list-header-checkbox"><input type="checkbox" id="selectAll"></div>
        <div class="list-header-cell network-list-header-title">Title</div>
        <div class="list-header-cell network-list-header-contact">Contact</div>
        <div class="list-header-cell network-list-header-type">Type</div>
        <div class="list-header-cell network-list-header-status">Status</div>
        <div class="list-header-cell network-list-header-code">Code</div>
        <div class="list-header-cell network-list-header-owner">Owner</div>
        <div class="list-header-cell network-list-header-time">Date</div>
    </div>

    {{#if selectedCount}}
        <div class="list-interactive-msg">
            <span class="text">
                <strong>{{selectedCount}}</strong> selected.
                {{#if showSelectAll}}
                    <a id="selectAllRemotes" class="pointer">&nbsp;Select all {{totalCount}}?</a>
                {{/if}}
            </span>
            {{#if areAllSelectedTheSameType}}
                {{#if withoutEmail}}
                    <span class="text-info">- {{withoutEmail}} have no email address</span>
                {{else}}
                    <i class="fa fa-long-arrow-right"></i> <button class="btn btn-sm btn-primary" id="sendTemplate"> send email template</button>
                {{/if}}
            {{else}}
                <div class="list-interactive-msg-options">
                    Select desired type: &nbsp;
                    <div class="btn-group" role="group">
                        {{#each differentTypesSelected}}
                            <a class="pointer selectOneType btn btn-default"> {{name}} - <strong>{{count}}</strong> </a>
                        {{/each}}
                    </div>
                </div>
            {{/if}}
        </div><!-- /.list-interactive-msg -->
    {{/if}}
</template>

<template name="contactableListSort">
    <div class="btn-group">
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
            Sort
            {{#with selectedSort}}
                <strong>{{displayName}}</strong>
                {{#if isAscSort .}}
                    <i class="fa fa-sort-amount-asc"> </i>
                {{else}}
                    <i class="fa fa-sort-amount-desc"> </i>
                {{/if}}
            {{/with}}
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu" role="menu">
            {{#each sortFields}}
                <li>
                    <a class="sort-field">
                        {{displayName}}
                        {{#if isFieldSelected .}}
                            {{#if isAscSort .}}
                                <i class="fa fa-sort-amount-asc"> </i>
                            {{else}}
                                <i class="fa fa-sort-amount-desc"> </i>
                            {{/if}}
                        {{/if}}
                    </a>
                </li>
            {{/each}}
        </ul>
    </div>
</template>